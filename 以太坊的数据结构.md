以太坊的数据结构主要由**状态树（State Trie）、交易树（Transactions Trie）和收据树（Receipts Trie）**组成，它们共同构成了以太坊区块链的核心数据层，采用Merkle Patricia Trie（MPT）结构来实现高效验证和数据一致性。

### 1. **状态树（State Trie）**

- **作用**：存储全局状态，包括所有账户（外部账户和合约账户）的当前信息。
    
    - 账户信息包含：**余额（balance）、Nonce（交易计数）、合约代码哈希（codeHash）、存储根哈希（storageRoot）**。
        
- **特点**：
    
    - **全局唯一**：整个网络只有一个状态树，随着区块更新而增量修改。
        
    - **MPT结构**：结合了Merkle Tree（验证）和Patricia Tree（前缀压缩），支持快速状态根哈希计算。
        
    - **键值对**：键是账户地址（20字节）的Keccak哈希，值是账户数据的RLP编码。
        
- **区块关联**：每个区块头包含一个`stateRoot`字段，是该区块处理后的状态树根哈希。
    

---

### 2. **交易树（Transactions Trie）**

- **作用**：记录当前区块中的所有交易，提供交易存在性证明。
    
- **特点**：
    
    - **每区块独立**：每个区块有独立的交易树，交易按执行顺序插入。
        
    - **MPT结构**：键是交易在区块中的索引（RLP编码），值是交易数据的RLP编码。
        
    - **轻节点验证**：通过交易树的Merkle证明（如`txRoot`）可验证某交易是否属于该区块。
        
- **区块关联**：区块头中的`transactionsRoot`是该区块交易树的根哈希。
    

---

### 3. **收据树（Receipts Trie）**

- **作用**：存储交易执行后的结果（收据），用于查询交易效果（如日志、Gas消耗、状态变更）。
    
    - 收据内容：**状态码（status）、Gas使用量、日志（logs）、日志Bloom过滤器**。
        
- **特点**：
    
    - **每区块独立**：与交易树一一对应，每个交易生成一个收据。
        
    - **日志Bloom过滤器**：高效过滤特定合约事件（如ERC-20转账）。
        
    - **MPT结构**：键是交易索引，值是收据数据的RLP编码。
        
- **区块关联**：区块头中的`receiptsRoot`是收据树的根哈希。
    

---

### 三者的协同关系

1. **执行流程**：
    
    - 用户发起交易 → 交易被写入区块的交易树。
        
    - 交易执行后更新状态树（如账户余额变化）并生成收据 → 收据写入收据树。
        
2. **验证机制**：
    
    - 轻节点可通过`stateRoot`、`transactionsRoot`和`receiptsRoot`验证状态、交易和收据，无需存储全量数据。
        
3. **安全性**：
    
    - 任何数据篡改都会改变MPT根哈希，导致区块头无效（因根哈希写入区块头并链式哈希连接）。
        

---

### 示例场景

- **查询账户余额**：从最新区块的`stateRoot`出发，在状态树中查找账户地址对应的节点。
    
- **证明交易存在**：提供交易树中从根到该交易的Merkle路径。
    
- **检索合约事件**：通过收据树的日志Bloom过滤器快速定位相关日志。
    

通过这种设计，以太坊在保证去中心化安全性的同时，实现了高效的数据访问和验证。