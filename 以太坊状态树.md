以太坊的状态树是其核心数据结构之一，用于存储和维护整个网络的全局状态。以下是详细介绍：

---

### **什么是以太坊状态树？**

以太坊的状态树是一个**默克尔帕特里夏树（Merkle Patricia Trie, MPT）**，它记录了网络中所有账户的实时状态。每个区块都有一个对应的状态树，存储以下信息：

1. **账户地址**：每个账户的唯一标识（160位地址）。
    
2. **账户余额（Balance）**：该地址持有的以太币数量。
    
3. **账户存储（Storage）**：智能合约的持久化数据（仅合约账户有）。
    
4. **账户代码哈希（CodeHash）**：智能合约代码的哈希值（仅合约账户有）。
    
5. **随机数（Nonce）**：账户的交易计数或合约创建次数。
    

---

### **状态树的作用**

1. **全局状态维护**  
    状态树是以太坊的“数据库”，保存所有账户的当前状态（余额、合约数据等），确保网络在任何时刻都能验证账户的有效性。
    
2. **快速状态验证**  
    通过默克尔树结构，任何节点可以快速验证某个账户的状态是否属于当前区块，而无需下载全部数据（轻节点依赖此特性）。
    
3. **一致性保证**  
    每个区块的状态树根哈希（存储在区块头中）作为该区块状态的唯一指纹。任何状态修改都会生成新的根哈希，确保全网一致性。
    
4. **支持智能合约**  
    合约账户的存储树（Storage Trie）是状态树的子结构，使合约能持久化存储数据并高效更新。
    

---

### **关键特性**

- **增量更新**：状态树仅修改变动的部分，未修改的节点可被共享，节省存储空间。
    
- **密码学安全**：默克尔证明确保数据不可篡改。
    
- **高效查询**：帕特里夏树前缀压缩优化了键（地址）的查找效率。
    

---

### **示例场景**

当用户发起一笔交易时，以太坊虚拟机（EVM）会：

1. 从状态树读取发送方余额，验证是否足够支付交易。
    
2. 执行交易后，更新相关账户状态（如余额变化、合约存储修改）。
    
3. 生成新的状态树根哈希，写入新区块。